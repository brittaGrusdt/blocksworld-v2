---
title: "results experiment 2"
output:
  html_document:
    df_print: paged
---

```{r, warning=FALSE, message=FALSE}
library(ggforce)
library(here)
library(tidyverse)
source(here("R", "utils.R"))

N_trials <- list(train=15, test=18, color_vision=8);

# data_dir <-  here("data", "test-runs")
data_dir <- here("data", "prolific")

# result_dir <- here("data", "test-runs", "results", "experiment2")
result_dir <- here("data", "prolific", "results", "experiment2")

fn <- "exp2_tidy.rds"

data <- readRDS(paste(result_dir, fn, sep=.Platform$file.sep))

stimuli <- data$test %>% pull(id) %>% unique()
N_participants <- data$test %>% pull(prolific_id) %>% unique() %>% length()

plot_dir <- paste(result_dir, "plots", sep=.Platform$file.sep);
dir.create(plot_dir, showWarnings = FALSE)
```

## Experimental data: Produced sentences

```{r}
dat <- data$test %>% mutate(response = as.factor(response),
                            custom_response = as.factor(custom_response))
dat.standardized <- dat %>% standardize_color_groups_exp2();
```

```{r all-trials}
plotTrials <- function(dat, n_pages){
  for (pa in seq(1, n_pages)){
    # print(pa)
    p <- dat %>% 
      ggplot(aes(x=response)) +
      geom_bar() +
      facet_wrap_paginate(~id, nrow=2, ncol=1, page=pa, scales="free") + 
      theme(text = element_text(size=14),
            axis.text.x=element_text(angle=45, vjust = 0.5)) +
      labs(y="#participants") +
      coord_flip() +
      theme_bw()
    # p
    print(p)
  }
}
```

Plot responses per trial

```{r}
# +1 for example test-trial (ind2)
dat.standardized %>% group_by(id) %>% plotTrials(N_trials$test/2 + 1)
```

Plot specific trials seperately
```{r}
trial = "independent_ll"
data.specific = dat %>% filter(id==trial) %>% group_by(id)
data.specific %>%
  ggplot(aes(x=response)) + geom_bar() +
  facet_wrap(~group) +  
  theme(text = element_text(size=14),
        axis.text.x=element_text(angle=45, vjust = 0.5)) +
  labs(y="#participants", title=trial) +
  coord_flip() +
  theme_bw()
```

Plot set of generated utterances

```{r all-sentences}
plotSentences <- function(dat){ 
  df.sum = dat %>% group_by(response) %>% summarize(N=n(), .groups="keep")
  max <- df.sum %>% ungroup() %>% select(N) %>% max()
  p <- dat %>% 
    ggplot(aes(y=fct_rev(fct_infreq(response)))) +
    geom_bar(aes(fill=id), stat="count") + #   hier weiter machen!
    theme(text = element_text(size=14)) +
    scale_x_discrete(name="# generations", breaks = seq(1, max), labels = sprintf("%s", seq(1, max)), limits=sprintf("%s", seq(1, max))) +
    theme_bw()
  return(p)
}
p <- dat.standardized %>% plotSentences()
p
```

